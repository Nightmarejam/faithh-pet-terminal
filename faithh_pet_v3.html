<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAITHH PET Terminal v3.1</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #3B5A9D;
            --secondary: #E8A87C;
            --accent: #FFFFFF;
            --bg-dark: #1a1a2e;
            --bg-panel: rgba(0, 0, 0, 0.6);
            --border: #4a5c8f;
            --glow: rgba(59, 90, 157, 0.5);
            --success: #00ff88;
            --warning: #ffaa00;
            --error: #ff4444;
            --gemini: #4285f4;
            --chip-frame: #8b9dc3;
            --chip-green: #7cb342;
            --chip-blue: #42a5f5;
            --chip-red: #ef5350;
            --chip-yellow: #ffca28;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'Courier New', monospace;
            color: var(--accent);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .pet-container {
            width: 100%;
            max-width: 1200px;
            background: linear-gradient(145deg, #2d1b69, #1a0f3d);
            border: 4px solid var(--primary);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 0 30px var(--glow), inset 0 0 20px rgba(0, 0, 0, 0.3);
        }

        .pet-header {
            background: linear-gradient(90deg, var(--secondary), #f5b895);
            padding: 10px 20px;
            border-radius: 10px 10px 0 0;
            font-size: 24px;
            font-weight: bold;
            color: var(--bg-dark);
            letter-spacing: 4px;
            text-align: center;
            margin: -20px -20px 20px -20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00ff00;
            box-shadow: 0 0 10px #00ff00;
            animation: pulse-glow 2s infinite;
        }

        .status-indicator.warning { background: var(--warning); box-shadow: 0 0 10px var(--warning); }
        .status-indicator.error { background: var(--error); box-shadow: 0 0 10px var(--error); }

        @keyframes pulse-glow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Battle Chip Styling */
        .chip-bar {
            background: linear-gradient(145deg, rgba(0,0,0,0.8), rgba(0,0,0,0.5));
            border: 3px solid var(--chip-frame);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.5), 0 0 20px rgba(139, 157, 195, 0.3);
        }

        .chip-bar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-size: 11px;
            color: var(--secondary);
            letter-spacing: 2px;
        }

        .chip-slots {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        /* Battle Chip Card Design */
        .battle-chip {
            width: 90px;
            height: 130px;
            background: linear-gradient(145deg, #9ea8bb, var(--chip-frame));
            border: 3px solid #6b7a95;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            box-shadow: 
                0 4px 8px rgba(0,0,0,0.4),
                inset 0 1px 2px rgba(255,255,255,0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .battle-chip:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 8px 16px rgba(0,0,0,0.6), 0 0 20px var(--glow);
        }

        .battle-chip.empty {
            background: linear-gradient(145deg, rgba(0,0,0,0.6), rgba(0,0,0,0.4));
            border: 2px dashed #4a5c8f;
        }

        .battle-chip.empty:hover {
            border-color: var(--secondary);
            background: linear-gradient(145deg, rgba(59, 90, 157, 0.3), rgba(0,0,0,0.4));
        }

        /* Chip Header */
        .chip-header {
            background: linear-gradient(180deg, #4a5c8f, #3a4a6f);
            padding: 4px 0;
            text-align: center;
            font-size: 7px;
            letter-spacing: 1px;
            color: #fff;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* Chip Main Area */
        .chip-body {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .chip-body.green { background: linear-gradient(135deg, #8bc34a, #689f38); }
        .chip-body.blue { background: linear-gradient(135deg, #64b5f6, #1976d2); }
        .chip-body.red { background: linear-gradient(135deg, #ef5350, #c62828); }
        .chip-body.yellow { background: linear-gradient(135deg, #ffeb3b, #f57c00); }
        .chip-body.purple { background: linear-gradient(135deg, #ab47bc, #6a1b9a); }
        .chip-body.orange { background: linear-gradient(135deg, #ff9800, #e65100); }

        /* Screen reflection effect */
        .chip-body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 40%;
            background: linear-gradient(135deg, 
                rgba(255,255,255,0.3) 0%, 
                transparent 50%);
            pointer-events: none;
        }

        .chip-icon {
            font-size: 40px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 1;
        }

        .chip-name {
            font-size: 8px;
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            margin-top: 4px;
            font-weight: bold;
            z-index: 1;
        }

        /* Chip Code Badge */
        .chip-code {
            position: absolute;
            top: 8px;
            right: 6px;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #fff, #ddd);
            border: 2px solid #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: #333;
            box-shadow: 0 2px 4px rgba(0,0,0,0.4);
            z-index: 2;
        }

        /* Chip Connector Pins */
        .chip-connector {
            height: 18px;
            background: linear-gradient(90deg, 
                #4a4a4a 0%, #4a4a4a 10%,
                #ffa500 10%, #ffa500 20%,
                #4a4a4a 20%, #4a4a4a 30%,
                #ffa500 30%, #ffa500 40%,
                #4a4a4a 40%, #4a4a4a 50%,
                #ffa500 50%, #ffa500 60%,
                #4a4a4a 60%, #4a4a4a 70%,
                #ffa500 70%, #ffa500 80%,
                #4a4a4a 80%, #4a4a4a 90%,
                #ffa500 90%, #ffa500 100%
            );
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
            border-top: 1px solid #666;
        }

        /* Empty Slot Styling */
        .chip-empty-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #666;
        }

        .chip-empty-icon {
            font-size: 32px;
            opacity: 0.5;
            margin-bottom: 4px;
        }

        .chip-empty-text {
            font-size: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .panel {
            background: var(--bg-panel);
            border: 3px solid var(--border);
            border-radius: 15px;
            padding: 15px;
            box-shadow: inset 0 0 15px rgba(0, 255, 255, 0.1);
        }

        /* PULSE Monitor with SVG Dog */
        .pulse-monitor {
            text-align: center;
        }

        .pulse-avatar {
            width: 100px;
            height: 100px;
            margin: 0 auto 15px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1e3a5f, #2d5a8f);
            border: 4px solid #5BC2E7;
            box-shadow: 0 0 20px rgba(91, 194, 231, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
        }

        .pulse-name {
            font-size: 24px;
            color: #5BC2E7;
            letter-spacing: 4px;
            margin-bottom: 8px;
            text-shadow: 0 0 10px rgba(91, 194, 231, 0.8);
        }

        .pulse-status {
            font-size: 11px;
            color: #888;
        }

        /* Avatar Box */
        .avatar-box {
            width: 150px;
            height: 150px;
            margin: 0 auto 15px;
            background: linear-gradient(145deg, #4a0e78, #2d0a4a);
            border: 3px solid var(--primary);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 20px var(--glow);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 64px;
        }

        .avatar-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .name-tag {
            font-size: 28px;
            color: var(--secondary);
            text-shadow: 0 0 10px rgba(232, 168, 124, 0.8);
            margin-bottom: 10px;
            letter-spacing: 6px;
            text-align: center;
        }

        /* Tabs */
        .tab-nav {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .tab-btn {
            flex: 1;
            background: var(--bg-panel);
            border: 2px solid var(--border);
            border-radius: 10px 10px 0 0;
            padding: 12px 8px;
            color: var(--accent);
            cursor: pointer;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            background: rgba(59, 90, 157, 0.3);
        }

        .tab-btn.active {
            background: var(--primary);
            border-color: var(--secondary);
            box-shadow: 0 0 15px var(--glow);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Chat */
        .chat-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 15px;
            min-height: 500px;
        }

        .chat-log {
            background: var(--bg-panel);
            border: 3px solid var(--border);
            border-radius: 10px;
            padding: 15px;
            height: 500px;
            overflow-y: auto;
            font-size: 13px;
            line-height: 1.6;
        }

        .chat-message {
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(59, 90, 157, 0.1);
            border-left: 3px solid var(--primary);
            border-radius: 6px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .message-sender {
            color: var(--secondary);
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .provider-badge {
            font-size: 9px;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: bold;
        }

        .badge-gemini { background: var(--gemini); color: white; }
        .badge-ollama { background: var(--success); color: black; }

        .context-panel {
            background: var(--bg-panel);
            border: 3px solid var(--border);
            border-radius: 10px;
            padding: 15px;
            height: 500px;
            overflow-y: auto;
        }

        .input-area {
            grid-column: 1 / -1;
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .chat-input {
            flex: 1;
            background: var(--bg-panel);
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 12px;
            color: var(--accent);
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .send-btn, .action-btn {
            background: linear-gradient(145deg, var(--secondary), #d99667);
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            color: var(--bg-dark);
            font-weight: bold;
            cursor: pointer;
            font-size: 13px;
            text-transform: uppercase;
            transition: all 0.3s;
        }

        .send-btn:hover:not(:disabled), .action-btn:hover:not(:disabled) {
            box-shadow: 0 0 20px rgba(232, 168, 124, 0.6);
            transform: scale(1.05);
        }

        .send-btn:disabled, .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Status Items */
        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 12px;
        }

        .status-ok { color: var(--success); }
        .status-error { color: var(--error); }
        .status-warning { color: var(--warning); }

        /* Chip Library Grid */
        .chip-library {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 15px;
            padding: 10px;
        }

        /* Metrics */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }

        .metric-card {
            background: var(--bg-panel);
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .metric-value {
            font-size: 32px;
            font-weight: bold;
            color: var(--secondary);
            margin: 10px 0;
        }

        .metric-label {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="pet-container">
        <div class="pet-header">
            <div style="display: flex; align-items: center; gap: 10px;">
                <div class="status-indicator" id="main-status"></div>
                <span>PET</span>
            </div>
            <span>TERMINAL v3.1</span>
            <span id="system-time">--:--:--</span>
        </div>

        <!-- Battle Chip Bar -->
        <div class="chip-bar">
            <div class="chip-bar-header">
                <span>üé¥ ACTIVE CHIPS</span>
                <span id="combo-display">COMBO: NONE</span>
            </div>
            <div class="chip-slots" id="active-chips">
                <!-- Active chip slots will be populated here -->
            </div>
            <div style="display: flex; gap: 10px; margin-top: 12px; justify-content: center;">
                <button class="action-btn" style="padding: 8px 20px; font-size: 11px;" onclick="executeChips()">‚ö° EXECUTE</button>
                <button class="action-btn" style="padding: 8px 20px; font-size: 11px; background: linear-gradient(145deg, #666, #444);" onclick="clearAllChips()">‚úñ CLEAR ALL</button>
            </div>
        </div>

        <!-- Main Display -->
        <div class="main-grid">
            <div class="panel" style="text-align: center;">
                <div class="avatar-box" id="faithh-avatar">
                    <img src="images/faithh.png" alt="FAITHH" onerror="this.onerror=null; this.src='images/faithh.jpg'; this.onerror=function(){this.style.display='none'; this.parentElement.innerHTML='üë§';}">
                </div>
                <div class="name-tag">FAITHH</div>
                <div style="font-size: 11px; color: #888; margin-bottom: 10px;">
                    AI Assistant ‚Ä¢ <span id="faithh-status" class="status-ok">Online</span>
                </div>
            </div>

            <div class="panel pulse-monitor">
                <div style="color: var(--secondary); font-size: 14px; margin-bottom: 15px; letter-spacing: 3px;">WATCHDOG</div>
                <div class="pulse-avatar">
                    <img src="images/Pulse.png" alt="PULSE" onerror="this.onerror=null; this.src='images/pulse.jpg'; this.onerror=function(){this.style.display='none'; this.parentElement.innerHTML='üêï';}">
                </div>
                <div class="pulse-name">PULSE</div>
                <div class="pulse-status">System Monitor Active</div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('chat')">üí¨ CHAT</button>
            <button class="tab-btn" onclick="switchTab('chips')">üé¥ CHIPS</button>
            <button class="tab-btn" onclick="switchTab('pulse')">üìä PULSE</button>
            <button class="tab-btn" onclick="switchTab('rag')">üìö RAG</button>
            <button class="tab-btn" onclick="switchTab('status')">‚öôÔ∏è STATUS</button>
        </div>

        <!-- Chat Tab -->
        <div class="tab-content active" id="chat-tab">
            <div class="chat-container">
                <div class="chat-log" id="chat-messages">
                    <div class="chat-message">
                        <div class="message-sender">FAITHH</div>
                        <div>System initialized. Battle chips loaded. How can I assist you today?</div>
                    </div>
                </div>

                <div class="context-panel">
                    <div style="color: var(--secondary); font-size: 14px; margin-bottom: 10px;">‚ö° SYSTEM STATUS</div>
                    <div id="status-display">
                        <div class="status-item"><span>Connecting...</span></div>
                    </div>
                </div>
            </div>

            <div class="input-area">
                <input type="text" class="chat-input" id="chat-input" placeholder="Enter your message..." onkeypress="if(event.key==='Enter') sendMessage()">
                <button class="send-btn" id="send-btn" onclick="sendMessage()">SEND</button>
            </div>
        </div>

        <!-- Chip Library Tab -->
        <div class="tab-content" id="chips-tab">
            <div style="padding: 20px;">
                <h3 style="color: var(--secondary); margin-bottom: 15px; letter-spacing: 2px;">üé¥ BATTLE CHIP LIBRARY</h3>
                <div style="margin-bottom: 20px; font-size: 12px; color: #888;">
                    Click a chip to equip it to an active slot. Combine matching codes for powerful combos!
                </div>
                <div class="chip-library" id="chip-library">
                    <!-- Chips will be populated here -->
                </div>
            </div>
        </div>

        <!-- PULSE Dashboard Tab -->
        <div class="tab-content" id="pulse-tab">
            <div style="padding: 20px;">
                <h3 style="color: var(--secondary); margin-bottom: 20px; letter-spacing: 2px;">üìä PULSE SYSTEM MONITOR</h3>
                
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">Uptime</div>
                        <div class="metric-value" id="metric-uptime">--:--:--</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">API Calls</div>
                        <div class="metric-value" id="metric-calls">0</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Avg Response</div>
                        <div class="metric-value" id="metric-response">0ms</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Errors</div>
                        <div class="metric-value" id="metric-errors" style="color: var(--error);">0</div>
                    </div>
                </div>

                <h4 style="color: var(--secondary); margin: 20px 0 10px 0;">HARDWARE METRICS</h4>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">üñ•Ô∏è CPU Usage</div>
                        <div class="metric-value" id="metric-cpu" style="font-size: 24px;">--%</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">üß† RAM Usage</div>
                        <div class="metric-value" id="metric-ram" style="font-size: 24px;">-- GB</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">üéÆ GPU 1 (RTX 3090)</div>
                        <div class="metric-value" id="metric-gpu1" style="font-size: 20px;">-- GB / 24 GB</div>
                        <div style="font-size: 10px; color: #888;" id="metric-gpu1-temp">Temp: --¬∞C</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">üéÆ GPU 2 (GTX 1080 Ti)</div>
                        <div class="metric-value" id="metric-gpu2" style="font-size: 20px;">-- GB / 11 GB</div>
                        <div style="font-size: 10px; color: #888;" id="metric-gpu2-temp">Temp: --¬∞C</div>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <h4 style="color: var(--secondary); margin-bottom: 10px;">SERVICE HEALTH</h4>
                    <div id="pulse-services"></div>
                </div>

                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button class="action-btn" onclick="restartServices()">üîÑ RESTART ALL</button>
                    <button class="action-btn" onclick="checkHealth()">üè• HEALTH CHECK</button>
                </div>
            </div>
        </div>

        <!-- RAG Tab -->
        <div class="tab-content" id="rag-tab">
            <div style="padding: 20px;">
                <h3 style="color: var(--secondary); margin-bottom: 20px; letter-spacing: 2px;">üìö RAG KNOWLEDGE BASE</h3>
                
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 12px; color: #888; margin-bottom: 10px;">
                        Search your 4-month conversation history for relevant context
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" class="chat-input" id="rag-query" placeholder="Search conversations..." style="flex: 1;" onkeypress="if(event.key==='Enter') queryRAG()">
                        <button class="action-btn" onclick="queryRAG()">üîç SEARCH</button>
                    </div>
                </div>

                <div id="rag-results" style="min-height: 400px; background: var(--bg-panel); border: 2px solid var(--border); border-radius: 10px; padding: 15px;">
                    <div style="text-align: center; color: #888; padding: 40px;">
                        Enter a query to search your conversation history
                    </div>
                </div>

                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button class="action-btn" onclick="viewHistory()">üìú VIEW HISTORY</button>
                    <button class="action-btn" onclick="exportRAG()">üíæ EXPORT DATA</button>
                </div>
            </div>
        </div>

        <!-- Status Tab -->
        <div class="tab-content" id="status-tab">
            <div style="padding: 20px; min-height: 500px;">
                <h3 style="color: var(--secondary); margin-bottom: 20px; letter-spacing: 2px;">‚öôÔ∏è DETAILED STATUS</h3>
                <div id="detailed-status">
                    <div class="status-item"><span>Loading...</span></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5555';
        let isProcessing = false;
        let callCount = 0;
        let errorCount = 0;
        let startTime = Date.now();
        let activeChipSlots = [null, null, null, null, null];
        let selectedChips = new Set(); // Track selected chips for execution

        // Battle Chip Data
        const availableChips = [
            { id: 'rag_query', name: 'RAG QUERY', icon: 'üìö', code: 'R', color: 'green', description: 'Search knowledge base' },
            { id: 'civic_write', name: 'CIVIC DOC', icon: '‚úçÔ∏è', code: 'C', color: 'blue', description: 'Write civic documents' },
            { id: 'code_gen', name: 'CODE GEN', icon: 'üíª', code: 'C', color: 'blue', description: 'Generate code snippets' },
            { id: 'analyze', name: 'ANALYZER', icon: 'üìä', code: 'A', color: 'yellow', description: 'Analyze data patterns' },
            { id: 'debug', name: 'DEBUGGER', icon: 'üêõ', code: 'D', color: 'red', description: 'Find and fix bugs' },
            { id: 'summarize', name: 'SUMMARY', icon: 'üìù', code: 'S', color: 'purple', description: 'Summarize text' },
            { id: 'translate', name: 'TRANSLATE', icon: 'üåê', code: 'T', color: 'green', description: 'Translate languages' },
            { id: 'image_gen', name: 'IMG GEN', icon: 'üé®', code: 'I', color: 'orange', description: 'Generate images' },
            { id: 'search', name: 'WEB SEARCH', icon: 'üîç', code: 'W', color: 'blue', description: 'Search the web' },
            { id: 'pulse_check', name: 'PULSE CHK', icon: 'üè•', code: 'P', color: 'red', description: 'System health check' },
            { id: 'optimize', name: 'OPTIMIZER', icon: '‚ö°', code: 'O', color: 'yellow', description: 'Optimize code' },
            { id: 'test', name: 'TEST GEN', icon: 'üß™', code: 'T', color: 'purple', description: 'Generate tests' }
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initializeChipSlots();
            loadChipLibrary();
            loadStatus();
            setInterval(() => {
                const now = new Date();
                document.getElementById('system-time').textContent = now.toLocaleTimeString();
                updateUptime();
            }, 1000);
            setInterval(loadStatus, 5000);
        });

        // Initialize chip slots
        function initializeChipSlots() {
            const slotsContainer = document.getElementById('active-chips');
            slotsContainer.innerHTML = '';
            
            for (let i = 0; i < 5; i++) {
                const slot = createEmptyChipSlot(i);
                slotsContainer.appendChild(slot);
            }
        }

        // Create empty chip slot
        function createEmptyChipSlot(slotIndex) {
            const chip = document.createElement('div');
            chip.className = 'battle-chip empty';
            chip.onclick = () => showChipLibrary(slotIndex);
            chip.innerHTML = `
                <div class="chip-header">BATTLE CHIP</div>
                <div class="chip-body">
                    <div class="chip-empty-content">
                        <div class="chip-empty-icon">+</div>
                        <div class="chip-empty-text">SLOT ${slotIndex + 1}</div>
                    </div>
                </div>
                <div class="chip-connector"></div>
            `;
            return chip;
        }

        // Create filled chip card
        function createChipCard(chip, isLibrary = false, slotIndex = null) {
            const card = document.createElement('div');
            card.className = 'battle-chip';
            
            if (isLibrary) {
                card.onclick = () => equipChip(chip);
            } else {
                // Active chip - click to select/deselect
                card.onclick = () => toggleChipSelection(slotIndex);
            }
            
            let removeButton = '';
            if (!isLibrary) {
                removeButton = `<div class="chip-remove" onclick="event.stopPropagation(); removeChip(${slotIndex})" title="Remove chip">‚úñ</div>`;
            }
            
            card.innerHTML = `
                ${removeButton}
                <div class="chip-header">BATTLE CHIP</div>
                <div class="chip-body ${chip.color}">
                    <div class="chip-code">${chip.code}</div>
                    <div class="chip-icon">${chip.icon}</div>
                    <div class="chip-name">${chip.name}</div>
                </div>
                <div class="chip-connector"></div>
            `;
            
            card.title = chip.description;
            return card;
        }

        // Load chip library
        function loadChipLibrary() {
            const library = document.getElementById('chip-library');
            library.innerHTML = '';
            
            availableChips.forEach(chip => {
                const card = createChipCard(chip, true);
                library.appendChild(card);
            });
        }

        // Equip chip to slot
        function equipChip(chip) {
            // Find first empty slot
            const emptySlotIndex = activeChipSlots.findIndex(slot => slot === null);
            
            if (emptySlotIndex === -1) {
                alert('All chip slots are full! Click an active chip to remove it first.');
                return;
            }
            
            // Add chip to slot
            activeChipSlots[emptySlotIndex] = chip;
            updateChipSlots();
            checkForCombos();
            
            // Show notification
            addMessage('SYSTEM', `‚úÖ ${chip.name} equipped to Slot ${emptySlotIndex + 1}`);
        }

        // Remove chip from slot
        function removeChip(slotIndex) {
            const chip = activeChipSlots[slotIndex];
            if (chip) {
                activeChipSlots[slotIndex] = null;
                selectedChips.delete(slotIndex);
                updateChipSlots();
                checkForCombos();
                addMessage('SYSTEM', `üóëÔ∏è ${chip.name} removed from Slot ${slotIndex + 1}`);
            }
        }

        // Clear all chips
        function clearAllChips() {
            if (activeChipSlots.some(chip => chip !== null)) {
                if (confirm('Remove all equipped chips?')) {
                    activeChipSlots = [null, null, null, null, null];
                    selectedChips.clear();
                    updateChipSlots();
                    checkForCombos();
                    addMessage('SYSTEM', 'üóëÔ∏è All chips cleared');
                }
            }
        }

        // Toggle chip selection
        function toggleChipSelection(slotIndex) {
            const slotsContainer = document.getElementById('active-chips');
            const chipElements = slotsContainer.querySelectorAll('.battle-chip');
            
            if (selectedChips.has(slotIndex)) {
                selectedChips.delete(slotIndex);
                chipElements[slotIndex].classList.remove('selected');
            } else {
                selectedChips.add(slotIndex);
                chipElements[slotIndex].classList.add('selected');
            }
        }

        // Execute selected chips (or all if none selected)
        async function executeChips() {
            const chipsToExecute = selectedChips.size > 0 
                ? Array.from(selectedChips).map(i => ({ chip: activeChipSlots[i], index: i })).filter(c => c.chip)
                : activeChipSlots.map((chip, index) => ({ chip, index })).filter(c => c.chip);
            
            if (chipsToExecute.length === 0) {
                alert('No chips equipped! Visit the CHIPS tab to select chips.');
                return;
            }

            addMessage('SYSTEM', `‚ö° Executing ${chipsToExecute.length} chip(s)...`);
            
            // Execute chips in sequence (agentic workflow)
            for (const { chip, index } of chipsToExecute) {
                await executeChip(chip);
                // Remove chip after execution
                activeChipSlots[index] = null;
            }
            
            selectedChips.clear();
            updateChipSlots();
            checkForCombos();
            addMessage('SYSTEM', '‚úÖ Chip execution complete!');
        }

        // Activate chip (legacy - kept for compatibility)
        function activateChip(chip, slotIndex) {
            toggleChipSelection(slotIndex);
        }

        // Execute chip function
        async function executeChip(chip) {
            // TODO: Implement actual chip execution via API
            switch(chip.id) {
                case 'rag_query':
                    switchTab('rag');
                    document.getElementById('rag-query').focus();
                    break;
                case 'pulse_check':
                    await checkHealth();
                    switchTab('pulse');
                    break;
                case 'code_gen':
                    addMessage('FAITHH', 'Code generation chip activated! What would you like me to code?', 'gemini');
                    break;
                default:
                    addMessage('FAITHH', `${chip.name} chip executed! (Functionality coming soon)`, 'gemini');
            }
        }

        // Update chip slots display
        function updateChipSlots() {
            const slotsContainer = document.getElementById('active-chips');
            slotsContainer.innerHTML = '';
            
            activeChipSlots.forEach((chip, index) => {
                if (chip) {
                    const card = createChipCard(chip, false, index);
                    slotsContainer.appendChild(card);
                } else {
                    const emptySlot = createEmptyChipSlot(index);
                    slotsContainer.appendChild(emptySlot);
                }
            });
        }

        // Check for chip combos
        function checkForCombos() {
            const activeCodes = activeChipSlots
                .filter(chip => chip !== null)
                .map(chip => chip.code);
            
            const comboDisplay = document.getElementById('combo-display');
            
            // Check for matching codes
            const codeCount = {};
            activeCodes.forEach(code => {
                codeCount[code] = (codeCount[code] || 0) + 1;
            });
            
            const maxCombo = Math.max(...Object.values(codeCount), 0);
            
            if (maxCombo >= 3) {
                const comboCode = Object.keys(codeCount).find(code => codeCount[code] === maxCombo);
                comboDisplay.textContent = `COMBO: ${comboCode}√ó${maxCombo}! ‚ö°`;
                comboDisplay.style.color = 'var(--warning)';
                comboDisplay.style.textShadow = '0 0 10px var(--warning)';
            } else {
                comboDisplay.textContent = 'COMBO: NONE';
                comboDisplay.style.color = 'var(--secondary)';
                comboDisplay.style.textShadow = 'none';
            }
        }

        // Show chip library (switch to chips tab)
        function showChipLibrary(slotIndex = null) {
            switchTab('chips');
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target?.classList.add('active');

            if (tabName === 'status') {
                loadDetailedStatus();
            } else if (tabName === 'pulse') {
                updatePulseMetrics();
            }
        }

        // Update uptime
        function updateUptime() {
            const elapsed = Date.now() - startTime;
            const hours = Math.floor(elapsed / 3600000);
            const minutes = Math.floor((elapsed % 3600000) / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            const uptimeEl = document.getElementById('metric-uptime');
            if (uptimeEl) {
                uptimeEl.textContent = `${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
            }
        }

        // Update PULSE metrics
        function updatePulseMetrics() {
            document.getElementById('metric-calls').textContent = callCount;
            document.getElementById('metric-errors').textContent = errorCount;
            
            loadStatus().then(() => {
                const servicesDiv = document.getElementById('pulse-services');
                if (servicesDiv) {
                    servicesDiv.innerHTML = document.getElementById('status-display').innerHTML;
                }
            });
        }

        // Load system status
        async function loadStatus() {
            const mainStatus = document.getElementById('main-status');
            const faithhStatus = document.getElementById('faithh-status');
            
            try {
                const response = await fetch(`${API_URL}/api/status`);
                const data = await response.json();
                
                mainStatus.className = 'status-indicator';
                faithhStatus.textContent = 'Online';
                faithhStatus.className = 'status-ok';
                
                let html = '';
                
                if (data.services) {
                    Object.entries(data.services).forEach(([name, status]) => {
                        const statusClass = status === 'online' || status === 'configured' ? 'status-ok' : 'status-error';
                        const statusText = status === 'configured' ? 'READY' : status.toUpperCase();
                        html += `<div class="status-item">
                            <span>${name}</span>
                            <span class="${statusClass}">‚óè ${statusText}</span>
                        </div>`;
                    });
                }
                
                document.getElementById('status-display').innerHTML = html;
            } catch (error) {
                mainStatus.className = 'status-indicator error';
                faithhStatus.textContent = 'Offline';
                faithhStatus.className = 'status-error';
                
                document.getElementById('status-display').innerHTML = 
                    '<div class="status-item status-error">‚ö† Backend API offline (port 5555)</div>';
            }
        }

        async function loadDetailedStatus() {
            const el = document.getElementById('detailed-status');
            el.innerHTML = '<div class="status-item"><span>Loading...</span></div>';
            await loadStatus();
            el.innerHTML = document.getElementById('status-display').innerHTML;
        }

        // Send message
        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const sendBtn = document.getElementById('send-btn');
            const message = input.value.trim();
            
            if (!message || isProcessing) return;
            
            isProcessing = true;
            input.disabled = true;
            sendBtn.disabled = true;
            sendBtn.innerHTML = '<span class="loading-spinner"></span> THINKING...';
            
            addMessage('USER', message);
            input.value = '';
            
            const startTime = performance.now();
            
            try {
                const response = await fetch(`${API_URL}/api/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message, mode: 'auto' })
                });
                
                const data = await response.json();
                const responseTime = Math.round(performance.now() - startTime);
                
                addMessage('FAITHH', data.response, data.provider);
                
                callCount++;
                const responseEl = document.getElementById('metric-response');
                if (responseEl) {
                    responseEl.textContent = responseTime + 'ms';
                }
            } catch (error) {
                addMessage('SYSTEM', '‚ö† Error: Could not connect to backend API. Make sure it\'s running on port 5555.');
                errorCount++;
            } finally {
                isProcessing = false;
                input.disabled = false;
                sendBtn.disabled = false;
                sendBtn.textContent = 'SEND';
                input.focus();
            }
        }

        function addMessage(sender, text, provider = '') {
            const messagesDiv = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message';
            
            let providerBadge = '';
            if (provider) {
                const badgeClass = provider === 'gemini' ? 'badge-gemini' : 'badge-ollama';
                providerBadge = ` <span class="provider-badge ${badgeClass}">${provider.toUpperCase()}</span>`;
            }
            
            messageDiv.innerHTML = `
                <div class="message-sender">${sender}${providerBadge}</div>
                <div>${text.replace(/\n/g, '<br>')}</div>
            `;
            
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // RAG functions
        async function queryRAG() {
            const query = document.getElementById('rag-query').value.trim();
            const resultsDiv = document.getElementById('rag-results');
            
            if (!query) {
                resultsDiv.innerHTML = '<div style="text-align: center; color: var(--warning); padding: 40px;">Please enter a search query</div>';
                return;
            }
            
            resultsDiv.innerHTML = '<div style="text-align: center; padding: 40px;"><span class="loading-spinner"></span> Searching...</div>';
            
            // TODO: Implement actual RAG query
            setTimeout(() => {
                resultsDiv.innerHTML = `
                    <div style="color: var(--warning); margin-bottom: 20px;">
                        ‚ö† RAG endpoint not yet implemented. Coming soon!
                    </div>
                    <div style="color: #888;">
                        Query: "${query}"<br>
                        This will search your 4-month conversation history once the backend is connected.
                    </div>
                `;
            }, 1000);
        }

        function viewHistory() {
            alert('View History - Coming Soon!\n\nThis will show your complete conversation history from the RAG database.');
        }

        function exportRAG() {
            alert('Export RAG Data - Coming Soon!\n\nThis will export your conversation history as JSON or CSV.');
        }

        // PULSE functions
        function restartServices() {
            if (confirm('Restart all FAITHH services?')) {
                alert('Restart functionality coming soon!\n\nThis will call the restart scripts.');
            }
        }

        async function checkHealth() {
            addMessage('SYSTEM', 'üè• Running health check...');
            await loadStatus();
            updatePulseMetrics();
            addMessage('SYSTEM', '‚úÖ Health check complete! All systems operational.');
        }

        console.log('ü§ñ FAITHH PET Terminal v3.1 loaded');
        console.log('Backend API: ' + API_URL);
        console.log('üé¥ Battle chips loaded:', availableChips.length);
    </script>
</body>
</html>